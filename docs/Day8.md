DAY 8 서브쿼리와 뷰

## 🟢 1단계: 기초 - "개념부터 탄탄하게!"

**[Q1] 다음 중 서브쿼리에 대한 설명으로 가장 적절하지 않은 것은?**

* ① 서브쿼리는 항상 괄호 `()`로 감싸야 한다.
* ② 서브쿼리는 메인 쿼리의 컬럼을 참조할 수 있다.
* ③ 메인 쿼리는 서브쿼리의 컬럼을 자유롭게 참조할 수 있다.
* ④ 서브쿼리 내에서는 원칙적으로 `ORDER BY` 절을 사용할 수 없다.

> **정답:** ③
> **해설:** 서브쿼리는 메인 쿼리의 컬럼을 사용할 수 있는 '상속' 구조를 가지지만, 반대로 메인 쿼리가 서브쿼리의 컬럼을 사용하는 것은 불가능합니다.
> **힌트:** '마트료시카' 인형을 떠올려 보세요. 안쪽 인형은 바깥쪽을 알 수 있지만, 바깥쪽은 안쪽의 세부 내용을 바로 꺼내 쓸 수 없습니다.

**[Q2] 다음 중 뷰(VIEW)의 특징으로 보기 어려운 것은?**

* ① 독립성: 테이블 구조가 바뀌어도 뷰 정의만 수정하면 응용 프로그램에 영향이 적다.
* ② 보안성: 사용자에게 숨기고 싶은 특정 컬럼을 제외하고 노출할 수 있다.
* ③ 영속성: 뷰를 생성하면 실제 데이터가 별도의 저장 공간에 물리적으로 복사된다.
* ④ 편리성: 복잡한 JOIN 쿼리를 뷰로 만들어 간단하게 조회할 수 있다.

> **정답:** ③
> **해설:** 뷰는 '가상 테이블'로, 실제 데이터를 저장하지 않고 쿼리 정의(TEXT)만 저장합니다.
> **힌트:** 뷰는 거울과 같습니다. 물체(데이터)는 테이블에 있고, 뷰는 그 모습을 비춰줄 뿐입니다.

**[Q3] SELECT 절에 사용되어 마치 하나의 컬럼처럼 동작하는 서브쿼리의 명칭은?**

* ① 인라인 뷰(Inline View)
* ② 스칼라 서브쿼리(Scalar Subquery)
* ③ 중첩 서브쿼리(Nested Subquery)
* ④ 연관 서브쿼리(Correlated Subquery)

> **정답:** ②
> **해설:** SELECT 절에 위치하여 단일 행, 단일 컬럼 값을 반환하는 서브쿼리를 '스칼라 서브쿼리'라고 부릅니다.
> **힌트:** '스칼라'는 수학에서 단일 값을 의미하는 용어입니다.

**[Q4] 다음 중 뷰를 생성(또는 수정)할 때 사용하는 SQL 명령어로 옳은 것은?**

* ① `UPDATE VIEW`
* ② `ALTER VIEW`
* ③ `CREATE OR REPLACE VIEW`
* ④ `MODIFY VIEW`

> **정답:** ③
> **해설:** 뷰의 정의를 변경할 때는 `ALTER` 대신 `DROP` 후 `CREATE` 하거나, `CREATE OR REPLACE VIEW`를 사용하여 덮어쓰기 합니다.
> **힌트:** 뷰는 구조를 수정하는 게 아니라 '다시 정의'하는 개념입니다.

**[Q5] 단일 행 서브쿼리 연산자가 아닌 것은?**

* ① `=`
* ② `<>`
* ③ `>=`
* ④ `ANY`

> **정답:** ④
> **해설:** `ANY`, `IN`, `ALL` 등은 서브쿼리 결과가 여러 개일 때 사용하는 '다중 행 연산자'입니다.
> **힌트:** `=` 뒤에 결과가 2개 나오면 에러가 난다는 사실을 기억하세요!

---

## 🟡 2단계: 중급 - "연산자와 위치의 이해"

**[Q6] 다음 SQL 문에서 사용된 서브쿼리의 종류는?**

```sql
SELECT E.ENAME, E.SAL
FROM EMP E, (SELECT DEPTNO, AVG(SAL) AS AVGSAL FROM EMP GROUP BY DEPTNO) D
WHERE E.DEPTNO = D.DEPTNO AND E.SAL > D.AVGSAL;

```

* ① 스칼라 서브쿼리
* ② 인라인 뷰
* ③ 중첩 서브쿼리
* ④ 상호연관 서브쿼리

> **정답:** ②
> **해설:** FROM 절에 위치하여 가상의 테이블 역할을 하는 서브쿼리를 '인라인 뷰'라고 합니다.
> **힌트:** "FROM 절에 있는 쿼리는 테이블 대타!"

**[Q7] 다음 중 다중 행 연산자와 그 의미가 바르게 연결되지 않은 것은?**

* ① `IN` : 서브쿼리 결과 중 하나라도 일치하면 참
* ② `> ALL` : 서브쿼리 결과의 모든 값보다 커야 함 (최대값보다 큼)
* ③ `< ANY` : 서브쿼리 결과의 모든 값보다 작아야 함 (최대값보다 작음)
* ④ `EXISTS` : 서브쿼리 결과가 1건이라도 존재하면 참

> **정답:** ③
> **해설:** `< ANY`는 결과값 중 최소한 하나보다만 작으면 되므로, 결과의 '최대값'보다 작으면 참이 됩니다. (모든 값보다 작으려면 `< ALL` 사용)
> **힌트:** `ANY`는 '어느 하나라도', `ALL`은 '모조리 다'라고 해석하세요.

**[Q8] 다음 SQL의 실행 결과로 적절한 것은? (EMP 테이블의 최고 급여는 5000이다)**

```sql
SELECT ENAME FROM EMP 
WHERE SAL >= (SELECT MAX(SAL) FROM EMP);

```

* ① 급여가 5000인 사원들만 조회된다.
* ② 모든 사원이 조회된다.
* ③ 문법 오류가 발생한다.
* ④ 아무도 조회되지 않는다.

> **정답:** ①
> **해설:** 서브쿼리에서 `MAX(SAL)`은 단일 값을 반환하므로 `=` 또는 `>=` 연산자와 함께 사용 가능한 단일 행 서브쿼리입니다.
> **힌트:** 집계 함수(`MAX`, `MIN`, `AVG`)가 사용된 서브쿼리는 보통 1개의 값만 뱉어냅니다.

**[Q9] 다음 중 뷰(VIEW)를 통해 DML(INSERT, UPDATE 등)을 수행할 수 없는 경우는?**

* ① 뷰 정의에 단일 테이블만 사용된 경우
* ② 뷰 정의에 `GROUP BY` 절이 포함된 경우
* ③ 뷰 정의에 `WHERE` 절 조건이 포함된 경우
* ④ 뷰 정의 시 모든 컬럼에 별칭을 사용한 경우

> **정답:** ②
> **해설:** `GROUP BY`, `DISTINCT`, 집계 함수 등이 포함된 뷰는 데이터의 원천이 불분명해지므로 DML 작업이 불가능합니다.
> **힌트:** "뭉쳐진 데이터를 어떻게 낱개로 수정하겠어?"라고 생각하면 쉽습니다.

**[Q10] 서브쿼리가 메인 쿼리의 컬럼을 포함하고 있어, 메인 쿼리의 각 행마다 서브쿼리가 반복 실행되는 형태는?**

* ① 비연관 서브쿼리
* ② 인라인 뷰
* ③ 연관 서브쿼리
* ④ 스칼라 서브쿼리

> **정답:** ③
> **해설:** 메인 쿼리의 값을 서브쿼리에 전달하여 조건에 맞는지 확인하는 방식을 '연관(Correlated) 서브쿼리'라고 합니다.
> **힌트:** 서브쿼리 안에 메인 테이블의 별칭(Alias)이 들어가 있는지 확인하세요.

---

## 🟠 3단계: 상급 - "시험 단골 함정 피하기"

**[Q11] 다음 SQL의 결과로 조회되는 행의 개수는? (EMP 테이블의 MGR 컬럼에 NULL이 하나 존재한다고 가정한다)**

```sql
SELECT COUNT(*) FROM EMP
WHERE EMPNO NOT IN (SELECT MGR FROM EMP);

```

* ① MGR에 없는 사원 수만큼 출력
* ② 전체 사원 수 출력
* ③ 0건 출력
* ④ 에러 발생

> **정답:** ③
> **해설:** `NOT IN` 연산 시 서브쿼리 결과에 `NULL`이 포함되어 있으면, 비교 결과가 모두 `UNKNOWN`이 되어 최종적으로 아무것도 조회되지 않습니다. (매우 빈출!)
> **힌트:** `NOT IN`과 `NULL`이 만나면 '폭탄'이 터져서 결과가 다 사라진다고 외우세요.

**[Q12] 다음 중 스칼라 서브쿼리에 대한 설명으로 옳은 것은?**

* ① 서브쿼리의 결과가 2건 이상이어도 첫 번째 행을 사용한다.
* ② 서브쿼리의 결과가 0건(데이터 없음)이면 에러가 발생한다.
* ③ 서브쿼리의 결과가 0건이면 NULL을 반환한다.
* ④ 가독성을 위해 주로 FROM 절에 사용한다.

> **정답:** ③
> **해설:** 스칼라 서브쿼리는 결과가 없으면 에러 대신 `NULL`을 반환하며, 2건 이상이면 에러가 발생합니다.
> **힌트:** SELECT 절에 넣었는데 값이 없으면 그냥 빈칸(NULL)이 나온다고 생각하세요.

**[Q13] 다음 중 서브쿼리를 사용할 수 없는 절은?**

* ① SELECT 절
* ② WHERE 절
* ③ HAVING 절
* ④ GROUP BY 절

> **정답:** ④
> **해설:** SQL 표준상 `GROUP BY` 절에는 서브쿼리를 사용할 수 없습니다.
> **힌트:** 그룹을 묶는 기준 자체를 쿼리로 동적으로 만들 수는 없습니다.

**[Q14] 다음 SQL 문장의 빈칸에 들어갈 연산자로 부서번호 30번 사원들 중 급여가 가장 적은 사람보다 더 적게 받는 사원을 조회하고자 할 때 적절한 것은?**

```sql
SELECT ENAME, SAL FROM EMP
WHERE SAL < (빈칸) (SELECT SAL FROM EMP WHERE DEPTNO = 30);

```

* ① `IN`
* ② `ANY`
* ③ `ALL`
* ④ `EXISTS`

> **정답:** ③
> **해설:** "가장 적은 사람보다 더 적다"는 것은 "모든 사람보다 적다"는 뜻이므로 `< ALL`을 사용해야 합니다.
> **힌트:** `< ALL`은 최소값보다 작음, `> ALL`은 최대값보다 큼!

**[Q15] 뷰(VIEW)를 삭제할 때 발생하는 현상으로 옳은 것은?**

* ① 뷰를 참조하고 있는 다른 뷰들은 자동으로 삭제된다.
* ② 뷰가 참조하고 있는 원본 테이블의 데이터도 함께 삭제된다.
* ③ 뷰의 정의(TEXT)만 삭제되고 원본 테이블에는 영향이 없다.
* ④ 뷰를 삭제하려면 반드시 원본 테이블을 먼저 삭제해야 한다.

> **정답:** ③
> **해설:** 뷰는 가상 테이블이므로 정의만 삭제될 뿐 실제 데이터(테이블)에는 영향을 주지 않습니다.
> **힌트:** 거울을 깬다고 해서 실물이 사라지지는 않습니다.

---

## 🔴 4단계: 심화 - "고득점을 위한 실전 유형"

**[Q16] 다음 중 뷰(VIEW)에 대한 설명으로 가장 부적절한 것은?**

* ① 뷰는 자신만의 인덱스를 생성하여 조회 성능을 높일 수 있다.
* ② 뷰는 복잡한 질의를 단순화하여 가독성을 높여준다.
* ③ 뷰를 정의할 때 `ORDER BY` 절을 사용할 수 있다.
* ④ 테이블 구조가 변경되어도 뷰의 정의를 통해 데이터 독립성을 확보할 수 있다.

> **정답:** ①
> **해설:** 뷰는 실제 데이터를 가지지 않으므로 자신만의 물리적 인덱스를 가질 수 없습니다. (원본 테이블의 인덱스를 활용할 뿐입니다.)
> **힌트:** 인덱스는 '데이터 위치'를 저장하는 것인데, 뷰는 데이터가 없으니 위치를 저장할 수 없겠죠?

**[Q17] 아래 SQL의 실행 결과와 동일한 결과를 내는 구문은?**

```sql
SELECT ENAME FROM EMP E
WHERE EXISTS (SELECT 1 FROM DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC = 'SEOUL');

```

* ① `SELECT ENAME FROM EMP WHERE DEPTNO IN (SELECT DEPTNO FROM DEPT WHERE LOC = 'SEOUL')`
* ② `SELECT ENAME FROM EMP WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE LOC = 'SEOUL')`
* ③ `SELECT ENAME FROM EMP WHERE DEPTNO ANY (SELECT DEPTNO FROM DEPT WHERE LOC = 'SEOUL')`
* ④ `SELECT ENAME FROM EMP WHERE DEPTNO ALL (SELECT DEPTNO FROM DEPT WHERE LOC = 'SEOUL')`

> **정답:** ①
> **해설:** `EXISTS`는 존재 여부만 확인하며, 이는 보통 `IN` 연산자를 사용한 비연관 서브쿼리와 동일한 결과를 냅니다. (단, 서울에 해당하는 부서가 여러 개일 수 있으므로 `=`은 위험합니다.)
> **힌트:** `EXISTS`는 `IN`과 친구라고 생각하면 편합니다.

**[Q18] 다음 중 연관 서브쿼리(Correlated Subquery)의 특징이 아닌 것은?**

* ① 서브쿼리 내에 메인 쿼리의 컬럼이 존재한다.
* ② 메인 쿼리의 결과가 서브쿼리로 전달되고, 다시 그 결과가 메인 쿼리에 영향을 준다.
* ③ 서브쿼리가 먼저 실행되어 단 한 번만 결과를 메인 쿼리에 전달한다.
* ④ 성능상 비연관 서브쿼리보다 불리할 수 있다.

> **정답:** ③
> **해설:** 연관 서브쿼리는 메인 쿼리의 각 행을 읽을 때마다 서브쿼리가 반복해서 실행됩니다. 한 번만 실행되는 것은 비연관 서브쿼리의 특징입니다.
> **힌트:** '연관'되어 있으니 계속 서로 주고받아야 해서 바쁘다고 생각하세요.

**[Q19] SQL Server(MSSQL) 환경에서 다음 중 오류가 발생하는 쿼리는?**

* ① SELECT 절의 스칼라 서브쿼리
* ② FROM 절의 인라인 뷰
* ③ 다중 컬럼 서브쿼리 (예: `WHERE (A, B) IN (SELECT A, B FROM ... )`)
* ④ WHERE 절의 다중 행 서브쿼리

> **정답:** ③
> **해설:** 다중 컬럼 서브쿼리(여러 컬럼을 한꺼번에 비교)는 오라클에서는 지원하지만 SQL Server에서는 지원하지 않는 문법입니다. (시험 단골 포인트!)
> **힌트:** "가로로 여러 개 묶어서 비교하는 건 오라클 전용!"

**[Q20] 다음은 TOP-N 쿼리를 작성하는 SQL이다. 빈칸에 들어갈 내용으로 적절한 것은?**

```sql
SELECT ENAME, SAL
FROM (SELECT ENAME, SAL FROM EMP (  빈칸  ))
WHERE ROWNUM <= 5;

```

* ① `GROUP BY SAL`
* ② `ORDER BY SAL DESC`
* ③ `HAVING SAL > 3000`
* ④ `WHERE SAL IS NOT NULL`

> **정답:** ②
> **해설:** 오라클에서 상위 N개를 뽑으려면 인라인 뷰 안에서 먼저 `ORDER BY`로 정렬을 한 뒤, 바깥에서 `ROWNUM`으로 잘라야 합니다.
> **힌트:** "서브쿼리에서 예외적으로 정렬이 허용되는 유일한 케이스"가 바로 이것입니다!

